---
pagename: App Extensions Template
Keywords:
sitesection: Documents
categoryname: "Rich Messaging"
documentname: Link Previews
permalink: link-previews-apple-business-chat-template.html
indicator: messaging
---

### Structured Content Schema for Custom iMessage Apps

#### Message Body

The structured content body will allow you to define the layout of the interactive message bubble representation in the agent workspace transcript as structured content basic elements.

Please note that the structured content body layout will not be represented on the consumerâ€™s message thread, but rather the iMessage bubble and app. The body will help the brands create a visual representation in LiveEngage of the iMessage bubble that was sent (for conversational context, transcript and historic records, as well as ease of use for agents).

In order to allow brands to report on the number of times an iMessage app was sent from an agent widget during a conversation, make sure to add a unified indication in the structured content message body for each type of iMessage app the brand uses. This will allow the brand to then track how many times a specific iMessage app was sent via a transcript search.

For the structured content body fields descriptions and different layout options please refer to the [structured content guide in our dev community. ](https://developers.liveperson.com/structured-content-templates.html)

#### Message Metadata

Sending custom interactive messages (custom iMessage app) data dictionary with structured content is supported via the message metadata. The metadata dictionary allows the connector to then indicate to Messages which app extension to use and provides the data to pass into the extension. Through the data dictionary brands can also set and control the visual appearance of the received bubble layout for the interactive message.


**Custom iMessage App Metadata Properties**

<table>
  <thead>
    <td>Property Name</td>
    <td>Description</td>
    <td>Type</td>
    <td>Required</td>
  </thead>
  <tbody>
  <tr>
    <td>type</td>
    <td>Type of metadata.                              Must be BusinessChatCustomMessage </td>
    <td>Enum</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>appId</td>
    <td>The App Store identifier of the custom                                 Messages framework extension </td>
    <td>Integer</td>
    <td>N</td>
  </tr>
  <tr>
    <td>appName</td>
    <td>The name of the custom Messages                               framework extension.</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>bid</td>
    <td>Identifies the Messages framework extension that the customer interacts with while using Messages. It is composed along with the extension bundleID, and teamID </td>
    <td>String</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>sessionIdentifier</td>
    <td>Valid UUID string, generated by the brand. This could represent a message or a group or messages that identifies the session or transaction</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>useLiveLayout</td>
    <td>A flag that determines if Live Layout is enabled. The default is false.</td>
    <td>Boolean</td>
    <td>N</td>
  </tr>
  <tr>
    <td>receivedMessage</td>
    <td>Bubble displayed when interactive message is received and LiveLayout is set to false</td>
    <td>Object</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>URL</td>
    <td>The URL to the data that is sent to the Messages framework extension. Should be sent encoded</td>
    <td>String</td>
    <td>Y</td>
  </tr>
  </tbody>
</table>


**Received Message Object Properties**

<table>
  <thead>
    <td>Property Name</td>
    <td>Description</td>
    <td>Type</td>
    <td>Required</td>
  </thead>
  <tbody>
  <tr>
    <td>title</td>
    <td>The title of the bubble</td>
    <td>String</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>subtitle</td>
    <td>Subtitle to be displayed under title in bubble </td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>secondarySubtitle</td>
    <td>Title that is aligned right</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>tertiarySubtitle</td>
    <td>Subtitle that is aligned right</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>imageTitle</td>
    <td>The title of the image attachment.</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>image Subtitle</td>
    <td>The subtitle of the image attachment.</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>imageURL</td>
    <td>Image to be placed in the iMessage app bubble layout. Will be presented when LiveLayout is disabled or when consumer does not have the brand app installed on iPhone/latest version is not updated with app extension</td>
    <td>String</td>
    <td>N</td>
  </tr>
  </tbody>
</table>


**
****Example Metadata JSON:** **[Custom iMessage Ap**p](https://docs.google.com/a/liveperson.com/document/d/1Jcm1l0AHo40qojWWQ0Dpcuq5VvsYSxHDrJVac9xqzTM/edit?usp=sharing)**
**

##### Reply Message object for custom interactive messages

The reply bubble structured content schema for custom interactive messages will now enable brands to create an end to end conversational experience with custom interactive messages (iMessage apps) - making sure agent or bots can view the received bubble sent to the consumer, as well as the associated reply bubble initiated by the consumer. The reply bubble will be defined as a textual representation.

The new property will allow the agent/bot to view the textual representation of the reply bubble, and will be added to the MSmessage "url" property. The URL schema can be defined both on the structure content outgoing message from the agent/bot, or only on the replied custom bubble from the consumer. Below you will find the URL scheme for the reply bubble:

**Encoded URL schema:**

"?data=%7B%0A%20%20%20%20%22lpData%3CBRAND_ID%3E%22%3A%20%7B%0A%20%20%20%20%20%20%22interactive%22%20%3A%20%7B%0A%20%20%20%20%20%20%20%20%22response%22%20%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%22text%22%3A%20%22%3CYOUR_CUSTOM_TEXT%3E%22%20%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D"

**Decoded query params:**

```json
{
    "lpData": {
      "interactive" : {
        "response" : {
          "text": "<YOUR_CUSTOM_TEXT>"
        }
      }
    }
}
```

### Some Notes About Custom iMessage App Support via Structured Content:

1. General recommendation for the URL field is to use an encoded data object which will represent the URL

2. **ImageURL MUST be whitelisted - **Image URLs added in the RecievedMessage must be whitelisted in the structured content image whitelisting area in Site Settings - > messaging.rich.content.valid.urls

3. Custom iMessage app response bubble - the connector currently does not capture reply bubble response from the consumer to the iMessage app. However, the transaction that occurred in the iMessage app by the consumer can be captured by the brand and updated in the Agent Widget SDK. (The response will be captured in the LE transcript line in future version).

4. Reporting - in order to allow brands to report on the number of times an iMessage app was sent from an agent widget during a conversation, make sure to add a unified indication in the structured content message body for each type of iMessage app the brand uses. This will allow the brand to then track how many times a specific iMessage app was sent via a transcript search.
